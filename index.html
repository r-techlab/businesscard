<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Card</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #2563eb;
            --primary-light: #3b82f6;
            --primary-dark: #1d4ed8;
            --text: #1f2937;
            --text-light: #6b7280;
            --bg: #f9fafb;
            --card-bg: #ffffff;
            --border: #e5e7eb;
            --shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: var(--bg);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            line-height: 1.6;
        }

        .card {
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: var(--shadow);
            width: 100%;
            max-width: 450px;
            overflow: hidden;
            position: relative;
            transition: var(--transition);
            border: 1px solid var(--border);
        }

        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(37, 99, 235, 0.15);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            padding: 40px 30px 30px;
            text-align: center;
            color: white;
            position: relative;
            overflow: hidden;
        }

        .card-header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
            transform: rotate(30deg);
            animation: shine 8s infinite linear;
        }

        @keyframes shine {
            0% { transform: rotate(30deg) translate(-20%, -20%); }
            100% { transform: rotate(30deg) translate(20%, 20%); }
        }

        .profile-img-container {
            width: 150px;
            height: 150px;
            margin: 0 auto 20px;
            border-radius: 50%;
            border: 5px solid rgba(255, 255, 255, 0.4);
            overflow: hidden;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            transition: var(--transition);
        }

        .card:hover .profile-img-container {
            transform: scale(1.05);
            border-color: rgba(255, 255, 255, 0.6);
        }

        .profile-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .name {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
            letter-spacing: 0.5px;
        }

        .title {
            font-size: 18px;
            font-weight: 400;
            opacity: 0.95;
            margin-bottom: 10px;
        }

        .company {
            font-size: 15px;
            font-weight: 500;
            display: inline-block;
            background: rgba(255, 255, 255, 0.25);
            padding: 8px 18px;
            border-radius: 25px;
            backdrop-filter: blur(5px);
            margin-bottom: 5px;
        }

        .card-body {
            padding: 30px;
        }

        .section-title {
            font-size: 15px;
            font-weight: 600;
            color: var(--primary);
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            font-size: 16px;
        }

        .section-title::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border);
            margin-left: 15px;
        }

        .contact-list {
            list-style: none;
            margin-bottom: 30px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 16px;
            border-radius: 12px;
            transition: var(--transition);
            text-decoration: none;
            color: inherit;
            border: 1px solid transparent;
        }

        .contact-item:hover {
            background: rgba(59, 130, 246, 0.08);
            border-color: rgba(59, 130, 246, 0.2);
            transform: translateX(5px);
        }

        .contact-icon {
            width: 48px;
            height: 48px;
            background: rgba(59, 130, 246, 0.12);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            flex-shrink: 0;
            color: var(--primary);
            font-size: 20px;
        }

        .contact-details {
            flex: 1;
        }

        .contact-label {
            font-size: 13px;
            color: var(--text-light);
            margin-bottom: 4px;
            font-weight: 500;
        }

        .contact-value {
            font-size: 16px;
            font-weight: 500;
            color: var(--text);
            white-space: pre-wrap;
            word-break: break-word;
            line-height: 1.6;
        }

        #address {
            margin: 0;
            max-width: 100%;
        }

        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 25px;
            margin-bottom: 30px;
        }

        .social-link {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(59, 130, 246, 0.12);
            color: var(--primary);
            transition: var(--transition);
            text-decoration: none;
            font-size: 20px;
        }

        .social-link:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-5px) scale(1.1);
        }

        .download-btn {
            display: block;
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
            text-align: center;
            text-decoration: none;
            font-size: 16px;
            letter-spacing: 0.5px;
        }

        .download-btn:hover {
            background: linear-gradient(135deg, var(--primary-dark), var(--primary));
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(37, 99, 235, 0.25);
        }

        .loading {
            padding: 60px 30px;
            text-align: center;
            color: var(--primary);
            font-weight: 500;
            font-size: 18px;
        }

        .loading:after {
            content: '...';
            animation: dots 1.5s steps(5, end) infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .edit-button {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.25);
            color: white;
            padding: 10px 12px;
            border-radius: 50%;
            text-decoration: none;
            font-size: 18px;
            font-weight: bold;
            transition: var(--transition);
            z-index: 2;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .edit-button:hover {
            background: rgba(255, 255, 255, 0.4);
            transform: rotate(15deg);
        }

        @media (max-width: 480px) {
            .card {
                border-radius: 20px;
                max-width: 100%;
            }
            
            .card-header {
                padding: 30px 20px 25px;
            }
            
            .profile-img-container {
                width: 130px;
                height: 130px;
            }
            
            .name {
                font-size: 24px;
            }
            
            .title {
                font-size: 16px;
            }
            
            .card-body {
                padding: 25px 20px;
            }
            
            .contact-item {
                padding: 14px;
            }
            
            .contact-icon {
                width: 44px;
                height: 44px;
                font-size: 18px;
            }
            
            .contact-value {
                font-size: 15px;
            }
        }

        /* Animation */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animated {
            animation: fadeIn 0.6s ease-out forwards;
        }

        .floating-shapes {
            position: absolute;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            overflow: hidden;
            z-index: -1;
            pointer-events: none;
        }

        .floating-shape {
            position: absolute;
            border-radius: 50%;
            background: linear-gradient(135deg, rgba(37, 99, 235, 0.1) 0%, rgba(59, 130, 246, 0.05) 100%);
            opacity: 0.6;
            animation: float 20s infinite linear;
        }

        .floating-shape:nth-child(1) {
            width: 100px;
            height: 100px;
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }

        .floating-shape:nth-child(2) {
            width: 70px;
            height: 70px;
            top: 60%;
            right: 10%;
            animation-delay: -5s;
        }

        .floating-shape:nth-child(3) {
            width: 50px;
            height: 50px;
            bottom: 20%;
            left: 15%;
            animation-delay: -10s;
        }

        @keyframes float {
            0% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
            100% { transform: translateY(0) rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="card">
        <div class="floating-shapes">
            <div class="floating-shape"></div>
            <div class="floating-shape"></div>
            <div class="floating-shape"></div>
        </div>
        
        <div id="loading" class="loading">Loading contact information</div>
        
        <div id="profile" style="display: none;">
            <div class="card-header">
                <div class="profile-img-container">
                    <img id="profile-image" src="" alt="Profile Image" class="profile-img">
                </div>
                <a id="edit-btn" class="edit-button" href="#" title="Edit">âœŽ</a>
                <h1 id="full-name" class="name"></h1>
                <p id="job-title" class="title"></p>
                <p id="company" class="company"></p>
            </div>

            <div class="card-body">
                <h3 class="section-title"><i class="fas fa-id-card"></i> Contact Information</h3>
                <ul class="contact-list">
                    <a href="#" id="email-link" style="text-decoration: none; color: inherit;">
                        <li class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="contact-details">
                                <div class="contact-label">Email Address</div>
                                <div id="email" class="contact-value"></div>
                            </div>
                        </li>
                    </a>
                    
                    <a href="#" id="phone-link" style="text-decoration: none; color: inherit;">
                        <li class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-phone-alt"></i>
                            </div>
                            <div class="contact-details">
                                <div class="contact-label">Phone Number</div>
                                <div id="phone" class="contact-value"></div>
                            </div>
                        </li>
                    </a>
                    
                    <div class="contact-item">
                        <div class="contact-icon">
                            <i class="fas fa-map-marker-alt"></i>
                        </div>
                        <div class="contact-details">
                            <div class="contact-label">Business Address</div>
                            <p id="address" class="contact-value"></p>
                        </div>
                    </div>
                    
                    <a href="#" id="website-link" style="text-decoration: none; color: inherit; display: none;">
                        <li class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div class="contact-details">
                                <div class="contact-label">Website</div>
                                <div id="website" class="contact-value"></div>
                            </div>
                        </li>
                    </a>
                </ul>

                <h3 class="section-title"><i class="fas fa-share-alt"></i> Social Profiles</h3>
                <div id="social-links" class="social-links">
                    <!-- Social links will be inserted here by JavaScript -->
                </div>

                <a href="#" class="download-btn" onclick="downloadContact(event)">
                    <i class="fas fa-download"></i> Save to Contacts
                </a>
            </div>
        </div>
    </div>

    <script>
        // Google Sheets ID and API key (same as your original)
        const SHEET_ID = '1IpgOJOIXEOlWaKhPXFAV4kWGJVw8WlfIaJHWicFSK-c';
        const API_KEY = 'AIzaSyByyiuwuJBysKl2xtvl6wCw6Gz9shyDzXs';
        const SHEET_NAME = 'BusinessCard';

        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            const contactId = urlParams.get('id') || '111';
            
            // Set href of edit button
            const editButton = document.getElementById('edit-btn');
            if (editButton && contactId) {
                editButton.href = `update.html?id=${encodeURIComponent(contactId)}`;
            }
            
            const loadingElement = document.getElementById('loading');
            const profileElement = document.getElementById('profile');

            if (!contactId) {
                loadingElement.textContent = 'Error: No contact ID provided. Add ?id=YOUR_ID to the URL.';
                return;
            }

            fetch(`https://sheets.googleapis.com/v4/spreadsheets/${SHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`Network error: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    const rows = data.values;
                    if (rows && rows.length > 0) {
                        const headers = rows[0].map(header => header.toLowerCase().trim());
                        const idColumnIndex = headers.indexOf('id');

                        if (idColumnIndex === -1) {
                            loadingElement.textContent = "Error: 'Id' column not found in the sheet.";
                            return;
                        }

                        let foundProfileData = null;
                        for (let i = 1; i < rows.length; i++) {
                            const currentRow = rows[i];
                            if (currentRow.length > idColumnIndex && currentRow[idColumnIndex] && currentRow[idColumnIndex].trim().toLowerCase() === contactId.trim().toLowerCase()) {
                                foundProfileData = currentRow;
                                break;
                            }
                        }

                        if (foundProfileData) {
                            loadingElement.style.display = 'none';
                            profileElement.style.display = 'block';
                            profileElement.classList.add('animated');

                            const profile = {};
                            headers.forEach((header, index) => {
                                const normalizedHeader = header;
                                profile[normalizedHeader] = index < foundProfileData.length ? foundProfileData[index] : '';
                            });
                            
                            populateCard(profile);
                        } else {
                            loadingElement.textContent = `Contact with ID '${contactId}' not found.`;
                        }
                    } else {
                        loadingElement.textContent = 'No data found in the sheet.';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    loadingElement.textContent = 'Error loading contact: ' + error.message;
                });
        });
        
        function populateCard(data) {
            // Set profile image with fallback
            const defaultImage = 'https://cdn.pixabay.com/photo/2015/10/05/22/37/blank-profile-picture-973460_1280.png';
            const googleDriveImageBase = 'https://lh3.googleusercontent.com/d/';
            const imageId = data.image_id;
            const profileImageUrl = imageId 
                ? `${googleDriveImageBase}${imageId}=s220?authuser=0`
                : defaultImage;
            
            document.getElementById('profile-image').src = data.profileimage || profileImageUrl || defaultImage;
            document.getElementById('full-name').textContent = data.fullname || data['full name'] || '';
            document.getElementById('job-title').textContent = data.jobtitle || data['job title'] || '';
            document.getElementById('company').textContent = data.company || '';
            
            // Contact info
            const emailValue = data.email || '';
            document.getElementById('email').textContent = emailValue;
            document.getElementById('email-link').href = emailValue ? `mailto:${emailValue}` : '#';
            
            const phoneValue = data.phone || '';
            document.getElementById('phone').textContent = phoneValue;
            document.getElementById('phone-link').href = phoneValue ? `tel:${phoneValue.replace(/\D/g, '')}` : '#';
            
            document.getElementById('address').textContent = data.address || '';
            
            // Website if available
            const websiteValue = data.website || data.websiteurl || data['website url'] || data['website_url'] || '';
            if (websiteValue) {
                document.getElementById('website').textContent = websiteValue;
                document.getElementById('website-link').href = websiteValue.startsWith('http') ? websiteValue : `https://${websiteValue}`;
                document.getElementById('website-link').style.display = 'block';
            }
            
            // Social links
            const socialLinksContainer = document.getElementById('social-links');
            socialLinksContainer.innerHTML = ''; 
            
            const socialPlatformsMap = {
                'linkedin': ['linkedin', 'linkedinurl', 'linkedin url', 'linkedin_url'],
                'whatsapp': ['whatsapp', 'whatsappurl', 'whatsapp url', 'whatsapp_url'],
                'instagram': ['instagram', 'instagramurl', 'instagram url', 'instagram_url'],
                'facebook': ['facebook', 'facebookurl', 'facebook url', 'facebook_url'],
                'twitter': ['twitter', 'twitterurl', 'twitter url', 'twitter_url'],
                'github': ['github', 'githuburl', 'github url', 'github_url'],
                'youtube': ['youtube', 'youtubeurl', 'youtube url', 'youtube_url'],
                'dribbble': ['dribbble', 'dribbbleurl', 'dribbble url', 'dribbble_url'],
                'behance': ['behance', 'behanceurl', 'behance url', 'behance_url']
            };
            
            const socialIcons = {
                linkedin: 'fab fa-linkedin-in',
                whatsapp: 'fab fa-whatsapp',
                instagram: 'fab fa-instagram',
                facebook: 'fab fa-facebook-f',
                twitter: 'fab fa-twitter',
                github: 'fab fa-github',
                youtube: 'fab fa-youtube',
                dribbble: 'fab fa-dribbble',
                behance: 'fab fa-behance'
            };
            
            let socialLinksFound = 0;
            for (const [platform, variations] of Object.entries(socialPlatformsMap)) {
                let socialUrl = null;
                
                for (const variant of variations) {
                    if (data[variant] && String(data[variant]).trim() !== '') {
                        socialUrl = String(data[variant]).trim();
                        break;
                    }
                }
                
                if (socialUrl && socialIcons[platform]) {
                    socialLinksFound++;
                    if (!socialUrl.startsWith('http://') && !socialUrl.startsWith('https://') && !socialUrl.startsWith('mailto:') && !socialUrl.startsWith('tel:')) {
                        if (platform === 'whatsapp' && /^\d+$/.test(socialUrl.replace(/\D/g,''))) {
                            socialUrl = `https://wa.me/${socialUrl.replace(/\D/g,'')}`;
                        } else {
                            socialUrl = 'https://' + socialUrl;
                        }
                    }
                    
                    const link = document.createElement('a');
                    link.href = socialUrl;
                    link.target = '_blank';
                    link.rel = 'noopener noreferrer';
                    link.title = platform.charAt(0).toUpperCase() + platform.slice(1);
                    link.className = 'social-link';
                    link.setAttribute('aria-label', platform);
                    
                    const icon = document.createElement('i');
                    icon.className = socialIcons[platform];
                    link.appendChild(icon);
                    
                    socialLinksContainer.appendChild(link);
                }
            }
            
            if (socialLinksFound === 0) {
                const noSocialMsg = document.createElement('p');
                noSocialMsg.textContent = 'No social links provided';
                noSocialMsg.style.color = 'var(--text-light)';
                noSocialMsg.style.fontSize = '14px';
                noSocialMsg.style.textAlign = 'center';
                noSocialMsg.style.width = '100%';
                socialLinksContainer.appendChild(noSocialMsg);
            }
        }
        
        function downloadContact(e) {
            e.preventDefault();
            
            const fullName = document.getElementById('full-name').textContent;
            const jobTitle = document.getElementById('job-title').textContent;
            const email = document.getElementById('email').textContent;
            const phone = document.getElementById('phone').textContent;
            const address = document.getElementById('address').textContent;
            const company = document.getElementById('company').textContent;
            
            const socialLinks = {};
            document.querySelectorAll('#social-links a').forEach(link => {
                const platform = link.title.toLowerCase();
                socialLinks[platform] = link.href;
            });
            
            let vCard = `BEGIN:VCARD
VERSION:3.0
FN:${fullName}
N:${fullName.split(' ').reverse().join(';')};;;
TITLE:${jobTitle}
ORG:${company}
EMAIL:${email}
TEL;TYPE=CELL:${phone}
ADR;TYPE=WORK:;;${address.replace(/\n/g, '\\n')}
`;

            // Add social links
            if (socialLinks.linkedin) vCard += `URL;type=LinkedIn:${socialLinks.linkedin}\n`;
            if (socialLinks.instagram) vCard += `URL;type=Instagram:${socialLinks.instagram}\n`;
            if (socialLinks.facebook) vCard += `URL;type=Facebook:${socialLinks.facebook}\n`;
            if (socialLinks.twitter) vCard += `URL;type=Twitter:${socialLinks.twitter}\n`;
            if (socialLinks.github) vCard += `URL;type=GitHub:${socialLinks.github}\n`;
            if (socialLinks.whatsapp) vCard += `URL;type=WhatsApp:${socialLinks.whatsapp}\n`;

            vCard += `END:VCARD`;

            const blob = new Blob([vCard], { type: 'text/vcard;charset=utf-8' });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `${fullName.toLowerCase().replace(/\s+/g, '_')}_contact.vcf`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
            
            // Show feedback
            const originalText = e.target.innerHTML;
            e.target.innerHTML = '<i class="fas fa-check"></i> Contact Saved!';
            e.target.style.background = 'linear-gradient(135deg, #10b981, #34d399)';
            
            setTimeout(() => {
                e.target.innerHTML = originalText;
                e.target.style.background = '';
            }, 2000);
        }
    </script>
</body>
</html>
